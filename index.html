<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EnRICH - Enhanced Reviews in Care Homes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@300;400;600;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --enrich-purple: #8B2A7D;
            --enrich-purple-dark: #6B1F5F;
            --enrich-purple-light: #A84D99;
            --enrich-blue: #2D7BC4;
            --enrich-blue-dark: #1E5A94;
            --enrich-blue-light: #4A9AE8;
            --enrich-navy: #1E3A5F;
            --enrich-teal: #2A6575;
            --white: #FFFFFF;
            --off-white: #F8F9FA;
            --light-gray: #E9ECEF;
            --text-gray: #495057;
            --shadow: 0 4px 20px rgba(30, 58, 95, 0.15);
            --shadow-hover: 0 8px 30px rgba(30, 58, 95, 0.25);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans Pro', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--off-white);
            color: var(--enrich-navy);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--enrich-purple) 0%, var(--enrich-purple-dark) 100%);
            color: var(--white);
            padding: 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-section img {
            height: 60px;
            width: auto;
            background: white;
            border-radius: 8px;
            padding: 4px;
        }

        .logo-text h1 {
            font-family: 'Merriweather', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .logo-text p {
            font-size: 0.85rem;
            opacity: 0.9;
            font-weight: 300;
        }

        nav {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        nav button {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: var(--white);
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        nav button:hover, nav button.active {
            background: var(--white);
            color: var(--enrich-purple);
        }

        /* NHS Banner */
        .nhs-banner {
            background: var(--enrich-blue);
            color: var(--white);
            text-align: center;
            padding: 0.5rem;
            font-size: 0.85rem;
        }

        .nhs-banner a {
            color: var(--white);
            text-decoration: underline;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--enrich-navy) 0%, var(--enrich-teal) 100%);
            color: var(--white);
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(139,42,125,0.2) 0%, transparent 70%);
            pointer-events: none;
        }

        .hero h2 {
            font-family: 'Merriweather', Georgia, serif;
            font-size: 2.2rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .hero p {
            font-size: 1.15rem;
            max-width: 800px;
            margin: 0 auto 1.5rem;
            opacity: 0.95;
            position: relative;
        }

        .hero-stats {
            display: flex;
            justify-content: center;
            gap: 3rem;
            flex-wrap: wrap;
            margin-top: 2rem;
            position: relative;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--enrich-blue-light);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Hero Action Buttons */
        .hero-actions {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-top: 2rem;
            position: relative;
        }

        .hero-referral-btn {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: var(--white);
            color: var(--enrich-purple);
            padding: 1rem 2rem;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .hero-referral-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        }

        .hero-btn-logo {
            height: 50px;
            width: auto;
            border-radius: 6px;
        }

        .hero-map-link {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.5);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .hero-map-link:hover {
            background: rgba(255,255,255,0.25);
            border-color: var(--white);
            transform: translateY(-3px);
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--enrich-purple);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .card.blue-accent {
            border-left-color: var(--enrich-blue);
        }

        .card h3 {
            font-family: 'Merriweather', Georgia, serif;
            color: var(--enrich-purple);
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .card.blue-accent h3 {
            color: var(--enrich-blue);
        }

        .card p, .card ul {
            color: var(--text-gray);
            font-size: 0.95rem;
        }

        .card ul {
            margin-left: 1.2rem;
            margin-top: 0.5rem;
        }

        .card li {
            margin-bottom: 0.4rem;
        }

        /* Clickable Card Links */
        a.card-link {
            text-decoration: none;
            display: block;
            cursor: pointer;
        }

        a.card-link:hover {
            transform: translateY(-6px);
        }

        a.card-link .learn-more {
            display: block;
            margin-top: 1rem;
            color: var(--enrich-purple);
            font-weight: 600;
            font-size: 0.9rem;
        }

        a.card-link.blue-accent .learn-more {
            color: var(--enrich-blue);
        }

        /* BGS Resources Card */
        .bgs-resources-card {
            background: linear-gradient(135deg, #006747 0%, #004d36 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            color: white;
        }

        .bgs-logo-placeholder {
            flex-shrink: 0;
        }

        .bgs-logo-text {
            width: 70px;
            height: 50px;
            background: white;
            color: #006747;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .bgs-content h4 {
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .bgs-content p {
            opacity: 0.9;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .bgs-links {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .bgs-links a {
            background: white;
            color: #006747;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .bgs-links a:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Meet the Team Section */
        .team-intro {
            text-align: center;
            margin-bottom: 2rem;
        }

        .team-pin-section {
            background: linear-gradient(135deg, #F5EBF4 0%, #E8EEF4 100%);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            max-width: 500px;
            margin: 0 auto 2rem auto;
        }

        .team-pin-section h3 {
            color: var(--enrich-navy);
            margin-bottom: 1rem;
        }

        .team-pin-section p {
            color: var(--text-gray);
            margin-bottom: 1.5rem;
        }

        .team-pin-inputs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .team-pin-digit {
            width: 50px;
            height: 55px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .team-pin-digit:focus {
            border-color: var(--enrich-purple);
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 42, 125, 0.2);
        }

        .team-pin-error {
            color: #dc3545;
            font-size: 0.9rem;
            display: none;
        }

        .team-content {
            display: none;
        }

        .team-content.visible {
            display: block;
        }

        .team-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .team-member {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 12px rgba(30, 58, 95, 0.08);
            border-top: 4px solid var(--enrich-purple);
            text-align: center;
        }

        .team-member-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .team-member h4 {
            color: var(--enrich-navy);
            margin-bottom: 0.25rem;
        }

        .team-member .role {
            color: var(--enrich-purple);
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.75rem;
        }

        .team-member .contact-info {
            background: #F5EBF4;
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 1rem;
        }

        .team-member .contact-info a {
            color: var(--enrich-blue);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .team-note {
            background: #E8EEF4;
            border-left: 4px solid var(--enrich-blue);
            padding: 1rem 1.5rem;
            border-radius: 0 8px 8px 0;
            margin-top: 2rem;
        }

        .team-note h4 {
            color: var(--enrich-navy);
            margin-bottom: 0.5rem;
        }

        .team-note p {
            color: var(--text-gray);
            margin: 0;
        }

        .team-note a {
            color: var(--enrich-blue);
        }

        @media (max-width: 768px) {
            .bgs-resources-card {
                flex-direction: column;
                text-align: center;
            }
            
            .bgs-links {
                justify-content: center;
            }

            .team-pin-digit {
                width: 45px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
        }

        /* PIN Entry Section */
        .pin-section {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .pin-box {
            background: var(--white);
            border-radius: 16px;
            padding: 3rem 2rem;
            box-shadow: var(--shadow);
            margin-top: 2rem;
        }

        .pin-box h2 {
            font-family: 'Merriweather', Georgia, serif;
            color: var(--enrich-purple);
            margin-bottom: 1rem;
        }

        .pin-box p {
            color: var(--text-gray);
            margin-bottom: 1.5rem;
        }

        .pin-input-container {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .pin-digit {
            width: 55px;
            height: 65px;
            font-size: 1.8rem;
            text-align: center;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-family: 'Source Sans Pro', sans-serif;
            font-weight: 600;
            color: var(--enrich-navy);
            transition: all 0.2s ease;
        }

        .pin-digit:focus {
            border-color: var(--enrich-purple);
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 42, 125, 0.2);
        }

        .btn {
            background: linear-gradient(135deg, var(--enrich-purple) 0%, var(--enrich-purple-dark) 100%);
            color: var(--white);
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 42, 125, 0.4);
        }

        .btn.blue {
            background: linear-gradient(135deg, var(--enrich-blue) 0%, var(--enrich-blue-dark) 100%);
        }

        .btn.blue:hover {
            box-shadow: 0 6px 20px rgba(45, 123, 196, 0.4);
        }

        .error-message {
            color: #dc3545;
            margin-top: 1rem;
            font-weight: 600;
            display: none;
        }

        /* Referral Form Section */
        .referral-form-container {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            box-shadow: var(--shadow);
            max-width: 700px;
            margin: 0 auto;
        }

        .referral-form-container h2 {
            font-family: 'Merriweather', Georgia, serif;
            color: var(--enrich-purple);
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .care-home-badge {
            background: linear-gradient(135deg, var(--enrich-purple) 0%, var(--enrich-purple-dark) 100%);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 2rem;
        }

        .care-home-badge span {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .care-home-badge strong {
            display: block;
            font-size: 1.3rem;
            margin-top: 0.25rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--enrich-navy);
            margin-bottom: 0.5rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.9rem 1rem;
            font-size: 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            border-color: var(--enrich-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(45, 123, 196, 0.15);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-hint {
            font-size: 0.85rem;
            color: var(--text-gray);
            margin-top: 0.4rem;
        }

        .email-preview {
            background: var(--off-white);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            color: var(--text-gray);
        }

        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 2rem;
        }

        /* Info Sections */
        .info-section {
            margin-bottom: 3rem;
        }

        .info-section h2 {
            font-family: 'Merriweather', Georgia, serif;
            color: var(--enrich-purple);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--enrich-purple);
            display: inline-block;
        }

        .info-section h3 {
            color: var(--enrich-navy);
            margin: 1.5rem 0 0.75rem;
        }

        .info-section p {
            color: var(--text-gray);
            margin-bottom: 1rem;
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(139,42,125,0.08) 0%, rgba(45,123,196,0.08) 100%);
            border-left: 4px solid var(--enrich-purple);
            padding: 1.5rem;
            border-radius: 0 10px 10px 0;
            margin: 1.5rem 0;
        }

        .highlight-box h4 {
            color: var(--enrich-purple);
            margin-bottom: 0.5rem;
        }

        /* Links Section */
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .link-card {
            background: var(--white);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
            display: block;
        }

        .link-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .link-card h4 {
            color: var(--enrich-blue);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .link-card p {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin: 0;
        }

        .link-card .link-url {
            color: var(--enrich-purple);
            font-size: 0.85rem;
            margin-top: 0.75rem;
            display: block;
            word-break: break-all;
        }

        /* Footer */
        footer {
            background: var(--enrich-navy);
            color: var(--white);
            padding: 2rem;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .footer-content p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .footer-content a {
            color: var(--enrich-blue-light);
        }

        /* Responsive - Tablets */
        @media (max-width: 992px) {
            nav {
                justify-content: center;
            }
            
            nav button {
                padding: 0.5rem 0.8rem;
                font-size: 0.85rem;
            }
        }

        /* Responsive - Mobile */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 1rem;
            }

            .logo-section {
                flex-direction: column;
                gap: 0.5rem;
            }

            .logo-section img {
                height: 50px;
            }

            .logo-text h1 {
                font-size: 1.3rem;
            }

            .logo-text p {
                font-size: 0.8rem;
            }

            /* Mobile Navigation - Scrollable */
            nav {
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
                padding-bottom: 5px;
                justify-content: flex-start;
            }

            nav::-webkit-scrollbar {
                display: none;
            }

            nav button {
                flex-shrink: 0;
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                min-height: 44px; /* iOS touch target */
            }

            .nhs-banner {
                font-size: 0.75rem;
                padding: 0.6rem 1rem;
            }

            .hero {
                padding: 1.5rem 1rem;
                border-radius: 12px;
                margin-bottom: 1.5rem;
            }

            .hero h2 {
                font-size: 1.4rem;
                line-height: 1.3;
            }

            .hero p {
                font-size: 1rem;
            }

            .hero-stats {
                gap: 1.5rem;
            }

            .hero-actions {
                flex-direction: column;
                gap: 1rem;
            }

            .hero-referral-btn {
                width: 100%;
                justify-content: center;
                padding: 1rem 1.5rem;
                font-size: 1.1rem;
                min-height: 60px;
            }

            .hero-btn-logo {
                height: 40px;
            }

            .hero-map-link {
                width: 100%;
                justify-content: center;
                padding: 1rem 1.5rem;
                min-height: 50px;
            }

            main {
                padding: 1rem;
            }

            /* Single column cards on mobile */
            .card-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .card {
                padding: 1.25rem;
            }

            .card h3 {
                font-size: 1.1rem;
            }

            .card ul {
                padding-left: 1.2rem;
            }

            .card li {
                margin-bottom: 0.4rem;
            }

            /* Info sections */
            .info-section h2 {
                font-size: 1.3rem;
            }

            .info-section h3 {
                font-size: 1.1rem;
            }

            .info-section p {
                font-size: 0.95rem;
            }

            .highlight-box {
                padding: 1rem;
            }

            /* PIN entry */
            .pin-box {
                padding: 1.5rem 1rem;
            }

            .pin-box h2 {
                font-size: 1.3rem;
            }

            .pin-input-container {
                gap: 8px;
            }

            .pin-digit {
                width: 48px;
                height: 58px;
                font-size: 1.5rem;
            }

            /* Referral form */
            .referral-form-container {
                padding: 1.25rem;
            }

            .referral-form-container h2 {
                font-size: 1.2rem;
            }

            .form-group label {
                font-size: 0.95rem;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: 16px; /* Prevents iOS zoom on focus */
                padding: 0.8rem;
            }

            .email-preview {
                font-size: 0.8rem;
                padding: 1rem;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                min-height: 50px;
                font-size: 1rem;
            }

            /* Links grid */
            .links-grid {
                grid-template-columns: 1fr;
            }

            /* Footer */
            footer {
                padding: 1.5rem 1rem;
            }

            .footer-content {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Extra small devices */
        @media (max-width: 380px) {
            .pin-digit {
                width: 42px;
                height: 52px;
                font-size: 1.3rem;
            }

            .hero h2 {
                font-size: 1.25rem;
            }

            nav button {
                padding: 0.5rem 0.7rem;
                font-size: 0.8rem;
            }
        }

        /* Print styles for QR code page */
        @media print {
            header, nav, footer, .nhs-banner {
                display: none !important;
            }
            main {
                padding: 0;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }

        /* Success message */
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        /* Back button */
        .back-btn {
            background: transparent;
            border: 2px solid var(--enrich-purple);
            color: var(--enrich-purple);
            padding: 0.6rem 1.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            margin-bottom: 1.5rem;
        }

        .back-btn:hover {
            background: var(--enrich-purple);
            color: var(--white);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-section">
                <img src="EnRICH_Logo_solid.png" alt="EnRICH Logo">
                <div class="logo-text">
                    <h1>EnRICH</h1>
                    <p>Enhanced Reviews in Care Homes</p>
                </div>
            </div>
            <nav>
                <button onclick="showSection('home')" class="active" id="nav-home">Home</button>
                <button onclick="showSection('about')" id="nav-about">About EnRICH</button>
                <button onclick="showSection('services')" id="nav-services">Our Services</button>
                <button onclick="showSection('team')" id="nav-team">Meet the Team</button>
                <button onclick="showSection('referral')" id="nav-referral">Make a Referral</button>
                <button onclick="showSection('resources')" id="nav-resources">Resources</button>
            </nav>
        </div>
    </header>

    <div class="nhs-banner">
        A service provided by <strong>Cambridge University Hospitals NHS Foundation Trust</strong> &amp; 
        <strong>Cambridgeshire & Peterborough NHS Foundation Trust</strong>
    </div>

    <main>
        <!-- HOME SECTION -->
        <section id="home" class="active">
            <div class="hero">
                <h2>Specialist Geriatrician Care for Care Home Residents</h2>
                <p>EnRICH delivers integrated geriatrician-led care spanning community, emergency department, and inpatient settings to improve outcomes for some of our most vulnerable patients.</p>
                <div class="hero-actions">
                    <button onclick="showSection('referral')" class="hero-referral-btn">
                        <img src="EnRICH_Logo_solid.png" alt="EnRICH Logo" class="hero-btn-logo">
                        <span>Make a Referral</span>
                    </button>
                    <a href="https://mjb302.github.io/enrich-map/" target="_blank" class="hero-map-link">
                        <span>üìç View Interactive Map</span>
                    </a>
                </div>
            </div>

            <div class="card-grid">
                <div class="card">
                    <h3>For Residents & Families</h3>
                    <p>Our specialist geriatricians provide comprehensive assessments in the care home, ensuring personalized care that respects your wishes and preferences.</p>
                    <ul>
                        <li>Holistic health assessments</li>
                        <li>Advance care planning discussions</li>
                        <li>Medication reviews</li>
                        <li>Family involvement in care decisions</li>
                    </ul>
                </div>
                <div class="card blue-accent">
                    <h3>For Care Home Staff</h3>
                    <p>We work alongside you to enhance resident care through education, support, and clear clinical guidance.</p>
                    <ul>
                        <li>Regular MDT meetings</li>
                        <li>Clinical training and support</li>
                        <li>Rapid access to specialist advice</li>
                        <li>Clear escalation pathways</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>For GPs & Community Teams</h3>
                    <p>EnRICH complements primary care delivery with specialist geriatric input for your most complex patients.</p>
                    <ul>
                        <li>Complex medication reviews</li>
                        <li>Advance care planning support</li>
                        <li>Shared care for multimorbid residents</li>
                        <li>Seamless communication</li>
                    </ul>
                </div>
            </div>

            <div class="highlight-box">
                <h4>Need to make a referral?</h4>
                <p>Healthcare professionals and care home staff can refer residents to our service. Click "Make a Referral" above and use your care home PIN code to access the referral form.</p>
            </div>
        </section>

        <!-- ABOUT SECTION -->
        <section id="about">
            <div class="info-section">
                <h2>About EnRICH</h2>
                
                <p>The <strong>Enhanced Reviews in Care Homes (EnRICH)</strong> service is an integrated geriatrician-led interface model developed by Cambridge University Hospitals NHS Foundation Trust in partnership with Cambridgeshire & Peterborough NHS Foundation Trust.</p>

                <h3>The Challenge We Address</h3>
                <p>Care home residents represent one of the most vulnerable patient populations, characterized by high rates of frailty, multiple comorbidities, cognitive impairment, and functional dependence. These residents often experience high rates of emergency hospital use, and hospital admission carries additional risks including delirium, deconditioning, hospital-acquired infections, and loss of function.</p>
                
                <p>For frail care home residents, hospital transfers can be particularly distressing, involving unfamiliar environments, disrupted routines, and separation from familiar carers during periods of acute vulnerability.</p>

                <h3>Our Solution</h3>
                <p>EnRICH delivers integrated geriatrician input spanning community, emergency department (front-door), and inpatient settings. The service provides both proactive and reactive care across the hospital-community boundary.</p>

                <div class="card-grid">
                    <div class="card">
                        <h3>Community-Based Care</h3>
                        <ul>
                            <li>Proactive Comprehensive Geriatric Assessments (CGAs)</li>
                            <li>Acute deterioration reviews in care homes</li>
                            <li>Advance care planning & ReSPECT discussions</li>
                            <li>Regular MDT meetings with care home staff</li>
                        </ul>
                    </div>
                    <div class="card blue-accent">
                        <h3>Hospital Interface Work</h3>
                        <ul>
                            <li>Emergency Department reviews for attending residents</li>
                            <li>Inpatient continuity of care</li>
                            <li>Rapid discharge facilitation</li>
                            <li>Front-door decision support</li>
                            <li>Virtual ward collaboration</li>
                        </ul>
                    </div>
                </div>

                <h3>Evidence of Impact</h3>
                <p>A rigorous quasi-experimental evaluation demonstrated substantial clinical impact. These improvements emerged 3-6 months after implementation, reflecting the time needed to build relationships and establish trust with care home staff and residents.</p>

                <div class="highlight-box">
                    <h4>Key Outcomes</h4>
                    <p><strong>43% reduction in ED attendances</strong> (Rate ratio: 0.57, p&lt;0.001)</p>
                    <p><strong>38% reduction in hospital admissions</strong> (Rate ratio: 0.62, p&lt;0.001)</p>
                    <p><strong>181 ED attendances avoided</strong> in the first year</p>
                    <p><strong>119 hospital admissions avoided</strong> in the first year</p>
                </div>
            </div>
        </section>

        <!-- SERVICES SECTION -->
        <section id="services">
            <div class="info-section">
                <h2>Our Services</h2>

                <div class="card-grid">
                    <a href="cga.html" class="card card-link">
                        <h3>Comprehensive Geriatric Assessment</h3>
                        <p>Targeted to high-risk residents including previous frequent presenters and GP-identified complex cases. Our assessments cover:</p>
                        <ul>
                            <li>Medical background and current concerns</li>
                            <li>Nutrition and swallowing</li>
                            <li>Mobility and falls risk</li>
                            <li>Cognition and psychological wellbeing</li>
                            <li>Medication review</li>
                            <li>Activities of daily living</li>
                        </ul>
                        <span class="learn-more">Learn more about CGA ‚Üí</span>
                    </a>

                    <a href="acp.html" class="card blue-accent card-link">
                        <h3>Advance Care Planning</h3>
                        <p>Systematic advance care planning ensures residents' wishes are known and respected:</p>
                        <ul>
                            <li>ReSPECT form completion</li>
                            <li>Family discussions about goals of care</li>
                            <li>End-of-life care planning</li>
                            <li>Clear ambulance guidance</li>
                            <li>Documentation of treatment preferences</li>
                        </ul>
                        <span class="learn-more">Learn more about ACP ‚Üí</span>
                    </a>

                    <div class="card">
                        <h3>Medication & Condition Reviews</h3>
                        <p>Expert review of complex medication regimens and chronic disease management:</p>
                        <ul>
                            <li>Polypharmacy optimization</li>
                            <li>Heart failure management</li>
                            <li>Falls prevention strategies</li>
                            <li>Delirium prevention</li>
                            <li>Community-based interventions (IV antibiotics, parenteral diuretics)</li>
                        </ul>
                    </div>

                    <div class="card blue-accent">
                        <h3>Acute Deterioration Response</h3>
                        <p>Rapid clinical support when residents become unwell:</p>
                        <ul>
                            <li>On-site assessment during crisis</li>
                            <li>Admission avoidance where safe and appropriate</li>
                            <li>ED review for residents who do attend</li>
                            <li>Rapid discharge facilitation</li>
                            <li>Virtual ward support</li>
                        </ul>
                    </div>

                    <div class="card">
                        <h3>Staff Education & Support</h3>
                        <p>Building confidence and capability in care home teams:</p>
                        <ul>
                            <li>Regular engagement and teaching</li>
                            <li>Clinical discussion and case review</li>
                            <li>Clear escalation pathways</li>
                            <li>Development of clinical policies</li>
                            <li>Rapid access to specialist advice</li>
                        </ul>
                    </div>

                    <div class="card blue-accent">
                        <h3>MDT Collaboration</h3>
                        <p>Working together for better outcomes:</p>
                        <ul>
                            <li>Regular MDT meetings</li>
                            <li>Partnership with Community Matrons</li>
                            <li>GP and primary care liaison</li>
                            <li>Collaboration with ambulance services</li>
                            <li>Integrated care system working</li>
                        </ul>
                    </div>
                </div>

                <!-- BGS Resources Card -->
                <div class="bgs-resources-card">
                    <div class="bgs-logo-placeholder">
                        <div class="bgs-logo-text">BGS</div>
                    </div>
                    <div class="bgs-content">
                        <h4>British Geriatrics Society Resources</h4>
                        <p>Our services are guided by evidence-based guidelines from the British Geriatrics Society, the professional body for healthcare professionals specialising in older people's care.</p>
                        <div class="bgs-links">
                            <a href="https://www.bgs.org.uk/CGA" target="_blank" rel="noopener noreferrer">CGA Hub</a>
                            <a href="https://www.bgs.org.uk/end-of-life-care-in-frailty-advance-care-planning" target="_blank" rel="noopener noreferrer">ACP Guidance</a>
                            <a href="https://www.bgs.org.uk" target="_blank" rel="noopener noreferrer">Visit BGS Website</a>
                        </div>
                    </div>
                </div>

                <div class="highlight-box">
                    <h4>Continuity of Care</h4>
                    <p>The same geriatrician team providing proactive community care also delivers front-door ED reviews and inpatient care. This continuity enables timely clinical decision-making informed by longitudinal knowledge of residents, more effective communication between care settings, and quicker, safer discharge planning.</p>
                </div>
            </div>
        </section>

        <!-- MEET THE TEAM SECTION -->
        <section id="team">
            <div class="container">
                <h2>Meet the Team</h2>
                
                <div class="team-intro">
                    <p>The EnRICH service is delivered by a dedicated team of healthcare professionals committed to improving care for care home residents across Cambridgeshire.</p>
                </div>

                <div class="team-pin-section" id="team-pin-entry">
                    <h3>üîí Healthcare Professional Access</h3>
                    <p>Enter your care home or GP practice PIN code to view team contact details.</p>
                    
                    <div class="team-pin-inputs">
                        <input type="text" class="team-pin-digit" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]*">
                        <input type="text" class="team-pin-digit" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]*">
                        <input type="text" class="team-pin-digit" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]*">
                        <input type="text" class="team-pin-digit" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]*">
                        <input type="text" class="team-pin-digit" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]*">
                    </div>
                    <div class="team-pin-error" id="team-pin-error">Invalid PIN. Please try again.</div>
                </div>

                <div class="team-content" id="team-content">
                    <div class="team-grid">
                        <div class="team-member">
                            <div class="team-member-icon">üë®‚Äç‚öïÔ∏è</div>
                            <h4>[Clinical Lead Name]</h4>
                            <div class="role">Consultant Geriatrician & Clinical Lead</div>
                            <div class="contact-info">
                                <a href="mailto:firstname.lastname@nhs.net">firstname.lastname@nhs.net</a>
                            </div>
                        </div>

                        <div class="team-member">
                            <div class="team-member-icon">üë©‚Äç‚öïÔ∏è</div>
                            <h4>[Team Member Name]</h4>
                            <div class="role">Specialist Registrar</div>
                            <div class="contact-info">
                                <a href="mailto:firstname.lastname@nhs.net">firstname.lastname@nhs.net</a>
                            </div>
                        </div>

                        <div class="team-member">
                            <div class="team-member-icon">üë©‚Äçüíº</div>
                            <h4>[Team Member Name]</h4>
                            <div class="role">Service Coordinator</div>
                            <div class="contact-info">
                                <a href="mailto:firstname.lastname@nhs.net">firstname.lastname@nhs.net</a>
                            </div>
                        </div>
                    </div>

                    <div class="team-note">
                        <h4>üìß General Enquiries</h4>
                        <p>For general enquiries about the EnRICH service: <a href="mailto:cuh.carehomesteam@nhs.net">cuh.carehomesteam@nhs.net</a></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- REFERRAL SECTION -->
        <section id="referral">
            <div class="pin-section" id="pin-entry">
                <div class="pin-box">
                    <h2>Healthcare Professional & Staff Portal</h2>
                    <p>Enter your 5-digit care home PIN code to access the referral form. This PIN was provided to your care home by the EnRICH team.</p>
                    
                    <div class="pin-input-container">
                        <input type="text" class="pin-digit" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]*" aria-label="PIN digit 1">
                        <input type="text" class="pin-digit" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]*" aria-label="PIN digit 2">
                        <input type="text" class="pin-digit" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]*" aria-label="PIN digit 3">
                        <input type="text" class="pin-digit" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]*" aria-label="PIN digit 4">
                        <input type="text" class="pin-digit" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]*" aria-label="PIN digit 5">
                    </div>

                    <button class="btn" onclick="validatePIN()">Access Referral Form</button>
                    
                    <p class="error-message" id="pin-error">Invalid PIN code. Please check and try again.</p>

                    <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-gray);">
                        Don't have a PIN? Contact the EnRICH team at <a href="/cdn-cgi/l/email-protection#92f1e7fabcf1f3e0f7fafdfff7e1e6f7f3ffd2fcfae1bcfcf7e6"><span class="__cf_email__" data-cfemail="412234296f22203324292e2c24323524202c012f29326f2f2435">[email&#160;protected]</span></a>
                    </p>
                </div>
            </div>

            <div id="referral-form" style="display: none;">
                <button class="back-btn" onclick="showPinEntry()">√¢‚Ä†¬ê Back to PIN Entry</button>
                
                <div class="referral-form-container">
                    <h2>EnRICH Referral Form</h2>
                    
                    <div class="care-home-badge">
                        <span>Referring from:</span>
                        <strong id="care-home-display"></strong>
                    </div>

                    <form id="enrich-referral-form">
                        <div class="form-group">
                            <label for="nhs-number">Patient NHS Number *</label>
                            <input type="text" id="nhs-number" name="nhs-number" placeholder="e.g., 123 456 7890" required>
                            <p class="form-hint">10-digit NHS number</p>
                        </div>

                        <div class="form-group">
                            <label for="patient-firstname">Patient First Name *</label>
                            <input type="text" id="patient-firstname" name="patient-firstname" required>
                        </div>

                        <div class="form-group">
                            <label for="patient-lastname">Patient Last Name *</label>
                            <input type="text" id="patient-lastname" name="patient-lastname" required>
                        </div>

                        <div class="form-group">
                            <label for="referral-reason">Reason for Referral *</label>
                            <textarea id="referral-reason" name="referral-reason" placeholder="Please describe the reason for referral, including any specific concerns or recent changes in the resident's condition..." required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="referrer-name">Your Name</label>
                            <input type="text" id="referrer-name" name="referrer-name" placeholder="Optional">
                        </div>

                        <div class="form-group">
                            <label for="referrer-role">Your Role</label>
                            <select id="referrer-role" name="referrer-role">
                                <option value="">Select your role (optional)</option>
                                <option value="Care Home Manager">Care Home Manager</option>
                                <option value="Registered Nurse">Registered Nurse</option>
                                <option value="Senior Carer">Senior Carer</option>
                                <option value="Carer">Carer</option>
                                <option value="GP">GP</option>
                                <option value="Community Matron">Community Matron</option>
                                <option value="District Nurse">District Nurse</option>
                                <option value="Other Healthcare Professional">Other Healthcare Professional</option>
                            </select>
                        </div>

                        <div style="margin-top: 2rem;">
                            <label style="font-weight: 600; color: var(--enrich-navy);">Email Preview</label>
                            <p class="form-hint">This information will be formatted for the referral email:</p>
                            <div class="email-preview" id="email-preview">
Care Home Name: [Will be auto-filled]
Patient NHS Number: 
Patient First Name: 
Patient Last Name: 
Reason for Referral: 

Referred by: 
Role: 
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn" onclick="sendReferralEmail()">
                                Open Email Client to Send
                            </button>
                            <button type="button" class="btn blue" onclick="copyToClipboard()">
                                Copy Details to Clipboard
                            </button>
                        </div>

                        <div class="success-message" id="copy-success">
                            √¢≈ì‚Äú Details copied to clipboard! You can now paste them into your email.
                        </div>
                    </form>

                    <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--light-gray); text-align: center;">
                        <p style="color: var(--text-gray); font-size: 0.9rem;">
                            Send referrals to: <a href="/cdn-cgi/l/email-protection#7714021f59141605121f181a12040312161a37191f0459191203" style="color: var(--enrich-purple); font-weight: 600;"><span class="__cf_email__" data-cfemail="afccdac781ccceddcac7c0c2cadcdbcacec2efc1c7dc81c1cadb">[email&#160;protected]</span></a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- RESOURCES SECTION -->
        <section id="resources">
            <div class="info-section">
                <h2>Useful Resources & Links</h2>
                
                <p>For more information about geriatric medicine, frailty, and local health services, please visit the following resources:</p>

                <div class="links-grid">
                    <a href="https://www.bgs.org.uk/" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>British Geriatrics Society (BGS)</h4>
                        <p>The professional body for healthcare professionals who specialise in the care of older people. Access guidelines, resources, and education on geriatric medicine.</p>
                        <span class="link-url">www.bgs.org.uk</span>
                    </a>

                    <a href="https://www.cuh.nhs.uk/" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>Cambridge University Hospitals</h4>
                        <p>Our host NHS Trust providing acute and specialist services at Addenbrooke's Hospital and The Rosie Hospital.</p>
                        <span class="link-url">www.cuh.nhs.uk</span>
                    </a>

                    <a href="https://www.cpft.nhs.uk/" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>Cambridgeshire & Peterborough NHS Foundation Trust (CPFT)</h4>
                        <p>Providing community and mental health services across Cambridgeshire and Peterborough, including community geriatric services.</p>
                        <span class="link-url">www.cpft.nhs.uk</span>
                    </a>

                    <a href="https://www.cpics.org.uk/" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>Cambridgeshire & Peterborough ICS</h4>
                        <p>The Integrated Care System bringing together NHS organisations, local authorities, and others to improve health and care services.</p>
                        <span class="link-url">www.cpics.org.uk</span>
                    </a>

                    <a href="https://www.bgs.org.uk/resources/resource-series/fit-for-frailty" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>Fit for Frailty (BGS)</h4>
                        <p>Comprehensive guidance on frailty assessment and management, including the Clinical Frailty Scale and best practice recommendations.</p>
                        <span class="link-url">www.bgs.org.uk/resources</span>
                    </a>

                    <a href="https://www.resus.org.uk/respect" target="_blank" rel="noopener noreferrer" class="link-card">
                        <h4>ReSPECT Process</h4>
                        <p>Information about Recommended Summary Plan for Emergency Care and Treatment - a process that creates personalised recommendations for clinical care.</p>
                        <span class="link-url">www.resus.org.uk/respect</span>
                    </a>
                </div>

                <div class="highlight-box" style="margin-top: 2rem;">
                    <h4>Contact the EnRICH Team</h4>
                    <p><strong>Email:</strong> <a href="/cdn-cgi/l/email-protection#4724322f69242635222f282a22343322262a07292f3469292233"><span class="__cf_email__" data-cfemail="e281978acc818390878a8d8f87919687838fa28c8a91cc8c8796">[email&#160;protected]</span></a></p>
                    <p style="margin-top: 0.5rem;">For urgent clinical queries during working hours, please contact the team directly. For emergency situations, always call 999.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2026 EnRICH - Enhanced Reviews in Care Homes<br>
            Cambridge University Hospitals NHS Foundation Trust</p>
            <p>
                Contact: <a href="/cdn-cgi/l/email-protection#ceadbba6e0adafbcaba6a1a3abbdbaabafa38ea0a6bde0a0abba"><span class="__cf_email__" data-cfemail="3c5f4954125f5d4e59545351594f48595d517c52544f12525948">[email&#160;protected]</span></a>
            </p>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Care Home PIN Database
        const careHomePINs = {
            '24569': 'Brook House Care Home',
            '13330': 'Cambridge Grove Care Home',
            '61396': 'Cambridge Manor Care Home',
            '30250': 'Hatley Court',
            '34568': 'Heathlands House',
            '47230': 'Highfield Care Home',
            '26985': 'Lily House',
            '18134': 'Maycroft Care Home',
            '63882': 'Southwell Court',
            '69642': 'Vera James House',
            '53033': 'Waterbeach Lodge',
            '30831': 'Langdon House',
            '65203': 'Alex Wood House',
            '22990': 'Etheldred House Care Home',
            '88733': 'Hilton Park - Oaklands',
            '84852': 'Home Meadow',
            '48884': 'Primrose Croft Care Home',
            '16274': 'Melbourn Springs Care Home',
            '70781': 'Home Close',
            '31180': 'Cleves Place',
            '27124': 'Queens Court',
            '81751': 'Townsend Manor',
            '57391': 'Fitzwilliam House Care Home',
            '39121': 'Bramley Court',
            '70148': 'Cottenham Court Care Home',
            '62340': 'Woodlands Care Centre',
            '47903': 'The Cambridgeshire Care Home',
            '78498': 'Melwood Grange',
            '36675': 'Midfield Lodge',
            '70896': 'Symonds House',
            '17371': 'Orchard House Residential Care Home'
        };

        let currentCareHome = '';

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(sectionId).classList.add('active');

            // Update nav buttons
            document.querySelectorAll('nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById('nav-' + sectionId).classList.add('active');

            // Scroll to top
            window.scrollTo(0, 0);

            // Reset referral section if needed
            if (sectionId === 'referral') {
                showPinEntry();
            }
        }

        // PIN Input handling
        const pinInputs = document.querySelectorAll('.pin-digit');
        
        pinInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value;
                
                // Only allow digits
                if (!/^\d*$/.test(value)) {
                    e.target.value = '';
                    return;
                }

                // Move to next input
                if (value && index < pinInputs.length - 1) {
                    pinInputs[index + 1].focus();
                }

                // Auto-submit when all filled
                if (index === pinInputs.length - 1 && value) {
                    validatePIN();
                }

                updateEmailPreview();
            });

            input.addEventListener('keydown', (e) => {
                // Handle backspace
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    pinInputs[index - 1].focus();
                }
                
                // Handle Enter
                if (e.key === 'Enter') {
                    validatePIN();
                }
            });

            // Handle paste
            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 5);
                
                pastedData.split('').forEach((digit, i) => {
                    if (pinInputs[i]) {
                        pinInputs[i].value = digit;
                    }
                });

                if (pastedData.length === 5) {
                    pinInputs[4].focus();
                    validatePIN();
                }
            });
        });

        function validatePIN() {
            const pin = Array.from(pinInputs).map(input => input.value).join('');
            const errorMsg = document.getElementById('pin-error');
            
            if (pin.length !== 5) {
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'Please enter all 5 digits.';
                return;
            }

            if (careHomePINs[pin]) {
                currentCareHome = careHomePINs[pin];
                showReferralForm();
                errorMsg.style.display = 'none';
            } else {
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'Invalid PIN code. Please check and try again.';
                // Shake animation
                document.querySelector('.pin-input-container').style.animation = 'none';
                setTimeout(() => {
                    document.querySelector('.pin-input-container').style.animation = '';
                }, 10);
            }
        }

        function showReferralForm() {
            document.getElementById('pin-entry').style.display = 'none';
            document.getElementById('referral-form').style.display = 'block';
            document.getElementById('care-home-display').textContent = currentCareHome;
            updateEmailPreview();
        }

        function showPinEntry() {
            document.getElementById('pin-entry').style.display = 'block';
            document.getElementById('referral-form').style.display = 'none';
            // Clear PIN inputs
            pinInputs.forEach(input => input.value = '');
            pinInputs[0].focus();
            // Clear form
            document.getElementById('enrich-referral-form').reset();
            currentCareHome = '';
        }

        // Form handling
        function updateEmailPreview() {
            const preview = document.getElementById('email-preview');
            const nhsNumber = document.getElementById('nhs-number').value || '';
            const firstName = document.getElementById('patient-firstname').value || '';
            const lastName = document.getElementById('patient-lastname').value || '';
            const reason = document.getElementById('referral-reason').value || '';
            const referrerName = document.getElementById('referrer-name').value || '';
            const referrerRole = document.getElementById('referrer-role').value || '';

            preview.textContent = `Care Home Name: ${currentCareHome || '[Will be auto-filled]'}
Patient NHS Number: ${nhsNumber}
Patient First Name: ${firstName}
Patient Last Name: ${lastName}
Reason for Referral: ${reason}

Referred by: ${referrerName}
Role: ${referrerRole}`;
        }

        // Add event listeners for form fields
        document.querySelectorAll('#enrich-referral-form input, #enrich-referral-form textarea, #enrich-referral-form select').forEach(field => {
            field.addEventListener('input', updateEmailPreview);
            field.addEventListener('change', updateEmailPreview);
        });

        function sendReferralEmail() {
            const nhsNumber = document.getElementById('nhs-number').value;
            const firstName = document.getElementById('patient-firstname').value;
            const lastName = document.getElementById('patient-lastname').value;
            const reason = document.getElementById('referral-reason').value;
            const referrerName = document.getElementById('referrer-name').value;
            const referrerRole = document.getElementById('referrer-role').value;

            if (!nhsNumber || !firstName || !lastName || !reason) {
                alert('Please fill in all required fields (NHS Number, First Name, Last Name, and Reason for Referral).');
                return;
            }

            const subject = encodeURIComponent(`EnRICH Referral - ${firstName} ${lastName} - ${currentCareHome}`);
            const body = encodeURIComponent(`EnRICH Referral Form

Care Home Name: ${currentCareHome}
Patient NHS Number: ${nhsNumber}
Patient First Name: ${firstName}
Patient Last Name: ${lastName}

Reason for Referral:
${reason}

---
Referred by: ${referrerName || 'Not specified'}
Role: ${referrerRole || 'Not specified'}

---
Sent via EnRICH Online Referral System`);

            window.location.href = `mailto:cuh.carehomesteam@nhs.net?subject=${subject}&body=${body}`;
        }

        function copyToClipboard() {
            const nhsNumber = document.getElementById('nhs-number').value;
            const firstName = document.getElementById('patient-firstname').value;
            const lastName = document.getElementById('patient-lastname').value;
            const reason = document.getElementById('referral-reason').value;
            const referrerName = document.getElementById('referrer-name').value;
            const referrerRole = document.getElementById('referrer-role').value;

            if (!nhsNumber || !firstName || !lastName || !reason) {
                alert('Please fill in all required fields before copying.');
                return;
            }

            const text = `EnRICH Referral Form

Care Home Name: ${currentCareHome}
Patient NHS Number: ${nhsNumber}
Patient First Name: ${firstName}
Patient Last Name: ${lastName}

Reason for Referral:
${reason}

---
Referred by: ${referrerName || 'Not specified'}
Role: ${referrerRole || 'Not specified'}`;

            navigator.clipboard.writeText(text).then(() => {
                const successMsg = document.getElementById('copy-success');
                successMsg.style.display = 'block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
            }).catch(err => {
                alert('Failed to copy. Please select and copy the text manually from the preview above.');
            });
        }

        // Check for PIN in URL (for QR code access)
        function checkURLForPIN() {
            const urlParams = new URLSearchParams(window.location.search);
            const pin = urlParams.get('pin');
            
            if (pin && pin.length === 5 && careHomePINs[pin]) {
                // Navigate to referral section
                showSection('referral');
                
                // Fill in the PIN
                const digits = pin.split('');
                pinInputs.forEach((input, index) => {
                    if (digits[index]) {
                        input.value = digits[index];
                    }
                });
                
                // Validate and show form
                setTimeout(() => {
                    validatePIN();
                }, 100);
            }
        }

        // TEAM PIN Input handling
        const teamPinInputs = document.querySelectorAll('.team-pin-digit');
        
        function validateTeamPIN() {
            const enteredPIN = Array.from(teamPinInputs).map(input => input.value).join('');
            const errorMsg = document.getElementById('team-pin-error');
            const teamContent = document.getElementById('team-content');
            const teamPinEntry = document.getElementById('team-pin-entry');
            
            if (enteredPIN.length === 5 && careHomePINs[enteredPIN]) {
                errorMsg.style.display = 'none';
                teamPinEntry.style.display = 'none';
                teamContent.classList.add('visible');
            } else if (enteredPIN.length === 5) {
                errorMsg.style.display = 'block';
                teamPinInputs.forEach(input => {
                    input.value = '';
                    input.style.borderColor = '#dc3545';
                });
                teamPinInputs[0].focus();
                setTimeout(() => {
                    teamPinInputs.forEach(input => {
                        input.style.borderColor = '#ddd';
                    });
                }, 1500);
            }
        }
        
        teamPinInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value;
                if (!/^\d*$/.test(value)) {
                    e.target.value = '';
                    return;
                }
                if (value && index < teamPinInputs.length - 1) {
                    teamPinInputs[index + 1].focus();
                }
                if (index === teamPinInputs.length - 1 && value) {
                    validateTeamPIN();
                }
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    teamPinInputs[index - 1].focus();
                }
                if (e.key === 'Enter') {
                    validateTeamPIN();
                }
            });

            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text').replace(/\D/g, '').slice(0, 5);
                pastedData.split('').forEach((digit, i) => {
                    if (teamPinInputs[i]) {
                        teamPinInputs[i].value = digit;
                    }
                });
                if (pastedData.length === 5) {
                    validateTeamPIN();
                }
            });
        });

        // Run on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkURLForPIN();
        });
    </script>
</body>
</html>